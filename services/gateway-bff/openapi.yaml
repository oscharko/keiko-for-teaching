openapi: 3.1.0
info:
  title: Keiko Gateway BFF API
  version: 0.1.0
  description: |
    Backend-for-Frontend (BFF) gateway service that aggregates and proxies requests
    to various backend microservices. Provides authentication, rate limiting, and
    request logging middleware.
  contact:
    name: Keiko Team
    email: support@keiko.ai

servers:
  - url: http://localhost:8000
    description: Local development
  - url: https://api.keiko.ai
    description: Production

tags:
  - name: Chat
    description: Chat service proxy endpoints
  - name: Search
    description: Search service proxy endpoints
  - name: Documents
    description: Document service proxy endpoints
  - name: Ideas
    description: Ideas service proxy endpoints
  - name: News
    description: News service proxy endpoints
  - name: Health
    description: Health check endpoints

paths:
  /health:
    get:
      summary: Health check
      description: Returns the health status of the gateway
      operationId: healthCheck
      tags:
        - Health
      responses:
        '200':
          description: Gateway is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /ready:
    get:
      summary: Readiness check
      description: Returns whether the gateway is ready to accept requests
      operationId: readinessCheck
      tags:
        - Health
      responses:
        '200':
          description: Gateway is ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /api/chat:
    post:
      summary: Chat with AI
      description: Proxy to chat service for AI conversations
      operationId: chat
      tags:
        - Chat
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
            text/event-stream:
              schema:
                type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/RateLimitError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/search:
    post:
      summary: Search documents
      description: Proxy to search service for document search
      operationId: search
      tags:
        - Search
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchRequest'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/RateLimitError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/documents/upload:
    post:
      summary: Upload document
      description: Proxy to document service for file uploads
      operationId: uploadDocument
      tags:
        - Documents
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Document uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/RateLimitError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/documents/{document_id}:
    get:
      summary: Get document metadata
      description: Proxy to document service for metadata retrieval
      operationId: getDocumentMetadata
      tags:
        - Documents
      security:
        - bearerAuth: []
      parameters:
        - name: document_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Document metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentMetadata'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Delete document
      description: Proxy to document service for document deletion
      operationId: deleteDocument
      tags:
        - Documents
      security:
        - bearerAuth: []
      parameters:
        - name: document_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Document deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/documents/{document_id}/download:
    get:
      summary: Download document
      description: Proxy to document service for file downloads
      operationId: downloadDocument
      tags:
        - Documents
      security:
        - bearerAuth: []
      parameters:
        - name: document_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Document file
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/documents:
    get:
      summary: List documents
      description: Proxy to document service for listing documents
      operationId: listDocuments
      tags:
        - Documents
      security:
        - bearerAuth: []
      parameters:
        - name: skip
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 100
      responses:
        '200':
          description: List of documents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/ideas:
    get:
      summary: List ideas
      description: Proxy to ideas service for listing ideas
      operationId: listIdeas
      tags:
        - Ideas
      security:
        - bearerAuth: []
      parameters:
        - name: skip
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: List of ideas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Idea'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      summary: Create idea
      description: Proxy to ideas service for creating ideas
      operationId: createIdea
      tags:
        - Ideas
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdeaCreate'
      responses:
        '201':
          description: Idea created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Idea'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/ideas/{idea_id}:
    get:
      summary: Get idea
      description: Proxy to ideas service for getting idea details
      operationId: getIdea
      tags:
        - Ideas
      security:
        - bearerAuth: []
      parameters:
        - name: idea_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Idea details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Idea'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/news:
    get:
      summary: List news
      description: Proxy to news service for listing news articles
      operationId: listNews
      tags:
        - News
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
        - name: skip
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: List of news articles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NewsArticle'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from authentication service

  schemas:
    # Chat schemas
    ChatRequest:
      type: object
      required:
        - messages
      properties:
        messages:
          type: array
          items:
            type: object
        context:
          type: object
        session_state:
          type: object

    ChatResponse:
      type: object
      properties:
        message:
          type: object
        context:
          type: object
        session_state:
          type: object

    # Search schemas
    SearchRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
        top_k:
          type: integer
        use_semantic_ranker:
          type: boolean
        query_vector:
          type: array
          items:
            type: number
        filter_expression:
          type: string

    SearchResponse:
      type: object
      properties:
        results:
          type: array
          items:
            type: object
        total_count:
          type: integer
        query:
          type: string
        cached:
          type: boolean

    # Document schemas
    DocumentMetadata:
      type: object
      properties:
        id:
          type: string
        filename:
          type: string
        content_type:
          type: string
        size:
          type: integer
        uploaded_at:
          type: string
        uploaded_by:
          type: string
        status:
          type: string
        blob_url:
          type: string

    UploadResponse:
      type: object
      properties:
        document_id:
          type: string
        filename:
          type: string
        size:
          type: integer
        status:
          type: string
        message:
          type: string

    DocumentListResponse:
      type: object
      properties:
        documents:
          type: array
          items:
            $ref: '#/components/schemas/DocumentMetadata'
        total_count:
          type: integer

    DeleteResponse:
      type: object
      properties:
        status:
          type: string
        message:
          type: string

    # Ideas schemas
    IdeaCreate:
      type: object
      required:
        - title
        - description
      properties:
        title:
          type: string
        description:
          type: string
        tags:
          type: array
          items:
            type: string

    Idea:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        tags:
          type: array
          items:
            type: string
        created_at:
          type: string
        author_id:
          type: string

    # News schemas
    NewsArticle:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        summary:
          type: string
        content:
          type: string
        source:
          type: string
        author:
          type: string
        published_at:
          type: string
        url:
          type: string
        image_url:
          type: string
        category:
          type: string
        sentiment:
          type: string
        tags:
          type: array
          items:
            type: string
        relevance_score:
          type: number

    # Common schemas
    HealthResponse:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        version:
          type: string
        service:
          type: string
        timestamp:
          type: integer

    ErrorResponse:
      type: object
      required:
        - error
        - code
      properties:
        error:
          type: string
        code:
          type: string
        details:
          type: object

  responses:
    UnauthorizedError:
      description: Authentication required or invalid token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    RateLimitError:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

